<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: imageDetectionService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: imageDetectionService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

const AsyncApiBase = require('./AsyncApiBase');
const assert = require('assert');
const queryString = require('query-string');
const constants = require('./lib/constants');

/**
 * API client of Netra's Image Detection Service.
 * @class
 * @constructor
 * @param {object} config
 * @property {string} config.defaultCallbackUrl - Address of where callbacks will be returned to, can be overridden in processImage.
 * @property {string=} config.apiKey - Can be obtained from https://dev.getnetra.com. Can be set as an environment variable NETRA_API_KEY.
 * @example
var ids = require('./app').ImageDetectionService

var config = {
	apiKey:'abcdefghijklmnopqrstuvwxyz',
	defaultCallbackUrl:'http://myApp.com/callback/'
}

var client = new ids(config)
 */
class ImageDetectionService extends AsyncApiBase{
		constructor(config) {
			let apiKey = config.apiKey || process.env.NETRA_API_KEY;
			assert(apiKey,'apiKey required. Set in config object or env variable NETRA_API_KEY')
			assert(config.defaultCallbackUrl,'defaultCallbackUrl required')			
			super(config.apiKey)
			this.defaultCallbackUrl = config.defaultCallbackUrl;
			this.apiUrl = constants.baseUrl + constants.imageDetectionService.route
		}

		/**
		 * Adds an image to the processing queue of the Netra API
		 * @param {string} image_url - a valid url of a public image
		 * @param {string} endpoint - classification model type. Object from ImageDetectionService.endpoints
		 * @param {string=} callback_url - callback url, will override ImageDetectionService.defaultCallbackUrl
		 * @param {object=} query_params - data that will be appended to the query params of the callback url
		 * @param {object=} metadata - data that will be added to a property called "metadata" in the callback JSON
		 * @returns {promise}
		 * @example 
		 * client.processImage(image_url, ids.validEndpoints.BRANDS)
		 * .then(data => console.log(data))
		 * .catch(error => console.log(error))
		 */
		async processImage(image_url, endpoint, callback_url=this.defaultCallbackUrl, query_params={}, metadata={}) {
			try {
				assert(image_url)
				assert(endpoint)
				assert.deepEqual(typeof(metadata),'object','metadata must be of type object');
				assert.deepEqual(typeof(query_params),'object','query_params must be of type object')
				assert.deepEqual(typeof(callback_url),'string','callback_url must be of type string')
				assert.deepEqual(typeof(endpoint),'string','endpoint must be of type string')
				assert.deepEqual(typeof(image_url),'string','image_url must be of type string')

				if(Object.values(constants.imageDetectionService.endpoints).indexOf(endpoint) > -1){
					let query_params_string = query_params ? queryString.stringify(query_params) : '';
					let url = this.apiUrl + constants.imageDetectionService.singleImage + endpoint
					let body = {
						'callback_url':callback_url + '?' + query_params_string,
						'image_url': image_url,
						'metadata': metadata
					}
					return await super.makeRequest(url,body)
				}else{
					throw Error('Invalid endpoint or type for argument \"endpoint\". Usage i.e. ImageDetectionService.endpoints.HUMANS')
				}
			} catch (error) {
				return Promise.reject(error);
			}
		}

		/**
		 * Returns object of valid endpoints for the ImageDetectionService route. i.e. client.endpoints.BRANDS
		 * @returns {object}
		 */
		static get validEndpoints(){
			return constants.imageDetectionService.endpoints;
		}

	}

module.exports = ImageDetectionService;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="ImageDetectionService.html">ImageDetectionService</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Dec 07 2017 11:16:03 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
